<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Creation System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .card-creation-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            align-items: start;
        }

        /* Flip Card Styles */
        .card-preview-section {
            position: sticky;
            top: 20px;
        }

        .card-preview-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .flip-card {
            background-color: transparent;
            width: 350px;
            height: 220px;
            margin: 0 auto;
            perspective: 1000px;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        .card.visa {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }

        .card.mastercard {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .card-content {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
        }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bank-info h3 {
            font-size: 18px;
            font-weight: bold;
        }

        .bank-info p {
            font-size: 12px;
            opacity: 0.8;
        }

        .card-type-logo {
            font-size: 24px;
            font-weight: bold;
        }

        .card-number {
            font-size: 22px;
            font-weight: 500;
            letter-spacing: 2px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
        }

        .card-bottom {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .card-holder {
            flex: 1;
        }

        .card-holder-label {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .card-holder-name {
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .card-expiry {
            text-align: right;
        }

        .card-expiry-label {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .card-expiry-date {
            font-size: 14px;
            font-weight: 500;
            font-family: 'Courier New', monospace;
        }

        .chip {
            position: absolute;
            top: 60px;
            left: 30px;
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 5px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .chip::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 2px;
        }

        /* Card Back Styles */
        .card-back-content {
            padding: 20px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
        }

        .magnetic-strip {
            background: #000;
            height: 40px;
            width: 100%;
            margin: 20px 0;
        }

        .signature-panel {
            background: #fff;
            height: 35px;
            width: 70%;
            margin: 10px 0;
            border-radius: 3px;
            position: relative;
        }

        .cvv-section {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }

        .cvv-label {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .cvv-number {
            font-size: 18px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .back-info {
            font-size: 10px;
            opacity: 0.8;
            text-align: center;
            margin-top: 10px;
        }

        /* Form Styles */
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
        }

        .form-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .card-type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .card-type-option {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .card-type-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card-type-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .pin-input {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .pin-digit {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        .pin-digit:focus {
            border-color: #667eea;
            outline: none;
        }

        .auto-generated {
            background: #e8f4fd;
            border: 2px solid #b8daff;
        }

        .auto-generated-label {
            font-size: 12px;
            color: #0056b3;
            margin-top: 5px;
        }

        .buttons {
            display: flex;
            gap: 11px;
            margin-top: 20px;
            flex-direction: column;
        }



        .btn {
            flex: 1;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-preview {
            background: #6c757d;
            color: white;
        }

        .btn-preview:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-create {
            background: #667eea;
            color: white;
        }

        .btn-create:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .flip-instruction {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        #adminCardCreation .extra-actions {
          display: flex;
         justify-content: center;
         gap: 15px;
         margin-top: 20px;
       }

#adminCardCreation .extra-actions .btn {
  padding: 10px 15px;
  font-size: 13px;
  border-radius: 8px;
}


        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .card-creation-wrapper {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .flip-card {
                width: 100%;
                max-width: 350px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
  .buttons {
    transform: scale(0.9);   /* shrink the whole container */
    max-width: 90%;          /* reduce container width */
    margin: 0 auto;          /* center it */
  }

  .buttons .btn {
    font-size: 14px;   /* smaller button text */
    padding: 8px 12px; /* reduce button size */
  }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
           <h1><img src="image/logo.webp" alt="PVB Logo" style="height: 40px; vertical-align: middle; margin-right: 10px;">PVB Bank Card Creation</h1>
            <p>Create your personalized debit card with real-time preview</p>
        </div>

        <div class="card-creation-wrapper">
            <div class="form-section">
                <h2 class="form-title">🎯 Create Your Card</h2>
                
                <form id="cardCreationForm">
                    <div class="form-group">
                        <label for="cardHolderName">Cardholder Name</label>
                        <input type="text" id="cardHolderName" name="cardHolderName" placeholder="Enter your full name" required maxlength="25">
                    </div>

                    <div class="form-group">
                        <label>Card Type</label>  
                        <div class="card-type-selector">
                            <div class="card-type-option" data-type="visa">
                                <div style="font-size: 20px; font-weight: bold; color: #1a1f71;">VISA</div>
                            </div>
                            <div class="card-type-option" data-type="mastercard">
                                <div style="font-size: 18px; font-weight: bold; color: #eb001b;">MasterCard</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>4-Digit Transaction PIN</label>
                        <div class="pin-input">
                            <input type="password" class="pin-digit" maxlength="1" pattern="[0-9]">
                            <input type="password" class="pin-digit" maxlength="1" pattern="[0-9]">
                            <input type="password" class="pin-digit" maxlength="1" pattern="[0-9]">
                            <input type="password" class="pin-digit" maxlength="1" pattern="[0-9]">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardNumber">Card Number</label>
                            <input type="text" id="cardNumber" name="cardNumber" class="auto-generated" readonly>
                            <div class="auto-generated-label">Auto-generated</div>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" name="cvv" class="auto-generated" readonly>
                            <div class="auto-generated-label">Auto-generated</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="text" id="expiryDate" name="expiryDate" class="auto-generated" readonly>
                        <div class="auto-generated-label">Auto-generated (2 years from now)</div>
                    </div>

                    <div class="buttons">
                        <button type="button" class="btn btn-preview" onclick="previewCard()">👁️ Preview Card</button>
                        <div class="extra-actions">
                          <button onclick="window.location.href='view-cards.html'" class="btn">View My Cards</button>
                          <button onclick="window.location.href='fund-card.html'" class="btn">Fund My Card</button>
                        </div>
                       <button type="submit" class="btn btn-create">🚀 Create Card</button>
                    </div>
                </form>
            </div>

            <div class="card-preview-section">
                <h3 class="card-preview-title">💳 Card Preview</h3>
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <!-- Front of Card -->
                        <div class="flip-card-front card visa" id="cardPreviewFront">
                            <div class="chip"></div>
                            <div class="card-content">
                                <div class="card-top">
                                    <div class="bank-info">
                                        <h3>PVB BANK</h3>
                                        <p>Your trusted partner</p>
                                    </div>
                                    <div class="card-type-logo" id="cardTypeLogo">VISA</div>
                                </div>
                                <div class="card-number" id="previewCardNumber">●●●● ●●●● ●●●● ●●●●</div>
                                <div class="card-bottom">
                                    <div class="card-holder">
                                        <div class="card-holder-label">CARD HOLDER</div>
                                        <div class="card-holder-name" id="previewCardHolder">YOUR NAME HERE</div>
                                    </div>
                                    <div class="card-expiry">
                                        <div class="card-expiry-label">VALID THRU</div>
                                        <div class="card-expiry-date" id="previewExpiry">MM/YY</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Back of Card -->
                        <div class="flip-card-back card visa" id="cardPreviewBack">
                            <div class="card-back-content">
                                <div class="magnetic-strip"></div>
                                <div style="position: relative;">
                                    <div class="signature-panel"></div>
                                    <div class="cvv-section">
                                        <div class="cvv-label">CVV</div>
                                        <div class="cvv-number" id="previewCVV">***</div>
                                    </div>
                                </div>
                                <div class="back-info">
                                    <p>PVB Bank - Customer Service: support@pvbonline.online</p>
                                    <p>For assistance call: +1-800-PVB-BANK</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flip-instruction">Hover over card to see back</div>
            </div>
        </div>
    </div>

    <script>
        let selectedCardType = 'visa';

        function previewCard() {
            updateCardPreview();
            const flipCard = document.querySelector('.flip-card-inner');
            flipCard.style.transform = 'rotateY(180deg)';
            setTimeout(() => {
                flipCard.style.transform = 'rotateY(0deg)';
            }, 2000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            initializeCardCreation();
            generateCardDetails();
            
            const cardCreationForm = document.getElementById('cardCreationForm');
            if (cardCreationForm) {
                cardCreationForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    if (!validateForm()) return;

                    const formData = {
                        cardHolderName: document.getElementById('cardHolderName').value,
                        cardType: selectedCardType,
                        cardNumber: document.getElementById('cardNumber').value.replace(/\s/g, ''),
                        cvv: document.getElementById('cvv').value,
                        expiryDate: document.getElementById('expiryDate').value,
                        transactionPin: getPin('.pin-digit')
                    };

                    const submitButton = e.target.querySelector('button[type="submit"]');
                    const originalText = submitButton.innerHTML;
                    submitButton.innerHTML = '<span class="loading"></span> Creating Card...';
                    submitButton.disabled = true;

                    try {
                        const response = await fetch('https://valley.pvbonline.online/api/user/create-card', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify(formData)
                        });

                        const result = await response.json();
                        
                        if (response.ok) {
                            alert('✅ Card application submitted successfully!\n\n📋 Your card is pending admin approval.\n\n⏳ You will be notified once approved.');
                            cardCreationForm.reset();
                            generateCardDetails();
                            updateCardPreview();
                        } else {
                            alert(`❌ Error: ${result.message}`);
                        }
                    } catch (error) {
                        alert('❌ Network error. Please try again.');
                        console.error('Error:', error);
                    } finally {
                        submitButton.innerHTML = originalText;
                        submitButton.disabled = false;
                    }
                });
            }
        });

        function initializeCardCreation() {
            document.querySelectorAll('.card-type-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.card-type-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCardType = this.dataset.type;
                    updateCardPreview();
                    generateCardDetails();
                });
            });

            setupPinInputs('.pin-digit');
            document.getElementById('cardHolderName').addEventListener('input', updateCardPreview);
            document.querySelector('.card-type-option[data-type="visa"]').classList.add('selected');
        }

        function setupPinInputs(selector) {
            const pinInputs = document.querySelectorAll(selector);
            pinInputs.forEach((input, index) => {
                input.addEventListener('input', function() {
                    if (this.value.length === 1 && index < pinInputs.length - 1) {
                        pinInputs[index + 1].focus();
                    }
                });

                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        pinInputs[index - 1].focus();
                    }
                });
            });
        }

        function generateCardNumber(cardType) {
            let prefix = cardType === 'visa' ? '4' : '5';
            let cardNumber = prefix;
            for (let i = 1; i < 16; i++) {
                cardNumber += Math.floor(Math.random() * 10);
            }
            return cardNumber.replace(/(.{4})/g, '$1 ').trim();
        }

        function generateCVV() {
            return Math.floor(100 + Math.random() * 900).toString();
        }

        function generateExpiryDate() {
            const now = new Date();
            const futureDate = new Date(now.getFullYear() + 2, now.getMonth());
            const month = (futureDate.getMonth() + 1).toString().padStart(2, '0');
            const year = futureDate.getFullYear().toString().slice(-2);
            return `${month}/${year}`;
        }

        function generateCardDetails() {
            document.getElementById('cardNumber').value = generateCardNumber(selectedCardType);
            document.getElementById('cvv').value = generateCVV();
            document.getElementById('expiryDate').value = generateExpiryDate();
            updateCardPreview();
        }

        function updateCardPreview() {
            // Update both front and back
            const cardFront = document.getElementById('cardPreviewFront');
            const cardBack = document.getElementById('cardPreviewBack');
            
            // Update card type styling
            cardFront.className = `flip-card-front card ${selectedCardType}`;
            cardBack.className = `flip-card-back card ${selectedCardType}`;
            
            // Update front elements
            document.getElementById('cardTypeLogo').textContent = selectedCardType === 'visa' ? 'VISA' : 'MasterCard';
            document.getElementById('previewCardNumber').textContent = document.getElementById('cardNumber').value || '●●●● ●●●● ●●●● ●●●●';
            document.getElementById('previewCardHolder').textContent = (document.getElementById('cardHolderName').value || 'YOUR NAME HERE').toUpperCase();
            document.getElementById('previewExpiry').textContent = document.getElementById('expiryDate').value || 'MM/YY';
            
            // Update back elements
            document.getElementById('previewCVV').textContent = document.getElementById('cvv').value || '***';
        }

        function getPin(selector) {
            const pinInputs = document.querySelectorAll(selector);
            return Array.from(pinInputs).map(input => input.value).join('');
        }

        function validateForm() {
            const nameField = document.getElementById('cardHolderName');
            const pinInputs = document.querySelectorAll('.pin-digit');
            
            if (!nameField.value.trim()) {
                alert('Please enter the cardholder name');
                return false;
            }

            const pin = Array.from(pinInputs).map(input => input.value).join('');
            if (pin.length !== 4) {
                alert('Please enter a 4-digit PIN');
                return false;
            }

            return true;
        }

        window.previewCard = previewCard;
    </script>
</body>
</html>