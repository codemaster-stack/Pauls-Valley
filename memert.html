<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memart - Shop Everything</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
        }

        .search-bar button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #667eea;
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .cart-icon {
            position: relative;
            cursor: pointer;
            font-size: 24px;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Categories */
        .categories {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .categories-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 30px;
            overflow-x: auto;
        }

        .category-btn {
            padding: 12px 25px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 16px;
            font-weight: 500;
        }

        .category-btn:hover, .category-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            background: #f8f9fa;
        }

        .product-info {
            padding: 20px;
        }

        .product-category {
            font-size: 12px;
            color: #667eea;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 10px;
        }

        .product-description {
            font-size: 14px;
            color: #636e72;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .add-to-cart-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .add-to-cart-btn:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            background: #667eea;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            font-size: 22px;
        }

        .close-cart {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: #667eea;
            font-weight: bold;
        }

        .remove-item {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }

        .cart-footer {
            padding: 20px;
            border-top: 2px solid #e9ecef;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .checkout-btn {
            width: 100%;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkout-btn:hover {
            background: #5a67d8;
        }

        /* Checkout Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #2d3436;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #636e72;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .card-select {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card-select:hover {
            border-color: #667eea;
        }

        .card-select.selected {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .card-number {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #2d3436;
        }

        .pay-btn {
            width: 100%;
            background: #10ac84;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .pay-btn:hover {
            background: #0e9872;
        }

        .pay-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-cart {
            text-align: center;
            padding: 50px 20px;
            color: #636e72;
        }

        .empty-cart i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
            }
            
            .search-bar {
                order: 3;
                width: 100%;
                margin: 15px 0 0 0;
                max-width: 100%;
            }

            .cart-sidebar {
                width: 100%;
                right: -100%;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-store"></i>
                Memart
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search for products...">
                <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
            </div>
            <div class="user-info">
                <div class="cart-icon" onclick="toggleCart()">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <span id="userName">User</span>
            </div>
        </div>
    </header>

    <!-- Categories -->
    <div class="categories">
        <div class="categories-content">
            <button class="category-btn active" onclick="filterCategory('all')">All Products</button>
            <button class="category-btn" onclick="filterCategory('homes')">Homes</button>
            <button class="category-btn" onclick="filterCategory('cars')">Cars</button>
            <button class="category-btn" onclick="filterCategory('gadgets')">Gadgets</button>
            <button class="category-btn" onclick="filterCategory('electronics')">Electronics</button>
            <button class="category-btn" onclick="filterCategory('fashion')">Fashion</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div class="products-grid" id="productsGrid"></div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>Shopping Cart</h2>
            <button class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout</button>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Checkout</h2>
                <button class="close-modal" onclick="closeCheckout()"><i class="fas fa-times"></i></button>
            </div>
            <form id="checkoutForm">
                <div class="form-group">
                    <label>Select Your Card</label>
                    <div id="cardsList"></div>
                </div>
                <div class="form-group">
                    <label for="pin">Enter PIN</label>
                    <input type="password" id="pin" maxlength="4" placeholder="4-digit PIN" required>
                </div>
                <div class="form-group">
                    <label for="address">Delivery Address</label>
                    <input type="text" id="address" placeholder="Enter delivery address" required>
                    <p style="margin-top: 8px; font-size: 14px;">
                      <a href="#" id="forgotCardPinLink" style="color: #667eea; text-decoration: underline;">Forgot PIN?</a>
                    </p>
                </div>
                <button type="submit" class="pay-btn" id="payBtn">Pay Now</button>
            </form>
        </div>
    </div>
    <!-- Forgot Card PIN Modal -->
<div class="modal" id="forgotCardPinModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Reset Card PIN</h2>
            <button class="close-modal" onclick="closeModal('forgotCardPinModal')"><i class="fas fa-times"></i></button>
        </div>
        <form id="forgotCardPinForm">
            <div class="form-group">
                <label for="cardSelectForReset">Select Card</label>
                <select id="cardSelectForReset" required>
                    <!-- JS will populate this with user's cards -->
                </select>
            </div>
            <button type="submit" class="pay-btn">Send PIN Reset Link</button>
        </form>
    </div>
</div>

<!-- Reset Card PIN Modal -->
<div class="modal" id="resetCardPinModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Enter New Card PIN</h2>
            <button class="close-modal" onclick="closeModal('resetCardPinModal')"><i class="fas fa-times"></i></button>
        </div>
        <form id="resetCardPinForm">
            <div class="form-group">
                <label for="resetCardSelect">Select Card</label>
                <select id="resetCardSelect" required>
                    <!-- JS will populate with user's cards -->
                </select>
            </div>
            <div class="form-group">
                <label for="newTransactionPin">New 4-digit PIN</label>
                <input type="password" id="newTransactionPin" maxlength="4" pattern="\d{4}" placeholder="Enter new PIN" required />
            </div>
            <button type="submit" class="pay-btn">Reset PIN</button>
        </form>
    </div>
</div>


    <script>
        // Sample Products Data
        const products = [
            // HOMES - 10 items
            { id: 1, name: "Luxury Villa", category: "homes", price: 850000, image: "https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=400", description: "5 bedroom luxury villa with pool" },
            { id: 2, name: "Modern Apartment", category: "homes", price: 320000, image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=400", description: "3 bedroom modern apartment downtown" },
            { id: 3, name: "Beach House", category: "homes", price: 1200000, image: "https://images.unsplash.com/photo-1499793983690-e29da59ef1c2?w=400", description: "Oceanfront property with private beach" },
            { id: 4, name: "Penthouse Suite", category: "homes", price: 2500000, image: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400", description: "Top floor penthouse with city views" },
            { id: 5, name: "Country Estate", category: "homes", price: 950000, image: "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400", description: "10 acre estate with stables" },
            { id: 6, name: "Modern Townhouse", category: "homes", price: 425000, image: "https://images.unsplash.com/photo-1572120360610-d971b9d7767c?w=400", description: "3-story townhouse in prime location" },
            { id: 7, name: "Lakeside Cabin", category: "homes", price: 380000, image: "https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=400", description: "Cozy cabin on private lake" },
            { id: 8, name: "City Loft", category: "homes", price: 565000, image: "https://images.unsplash.com/photo-1502672260066-6bc2257e7e8c?w=400", description: "Industrial loft in downtown" },
            { id: 9, name: "Mountain Chalet", category: "homes", price: 720000, image: "https://images.unsplash.com/photo-1449158743715-0a90ebb6d2d8?w=400", description: "Ski-in ski-out mountain retreat" },
            { id: 10, name: "Smart Home", category: "homes", price: 680000, image: "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400", description: "Fully automated smart home" },

            // CARS - 15 items
            { id: 11, name: "Tesla Model S", category: "cars", price: 94990, image: "https://images.unsplash.com/photo-1617788138017-80ad40651399?w=400", description: "Electric luxury sedan" },
            { id: 12, name: "BMW X5", category: "cars", price: 68500, image: "https://images.unsplash.com/photo-1555215695-3004980ad54e?w=400", description: "Premium SUV with advanced features" },
            { id: 13, name: "Mercedes-Benz S-Class", category: "cars", price: 115000, image: "https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?w=400", description: "Ultimate luxury sedan" },
            { id: 14, name: "Porsche 911", category: "cars", price: 125000, image: "https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=400", description: "Iconic sports car" },
            { id: 15, name: "Range Rover", category: "cars", price: 98000, image: "https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?w=400", description: "Luxury off-road SUV" },
            { id: 16, name: "Audi Q7", category: "cars", price: 62500, image: "https://images.unsplash.com/photo-1610768764270-790fbec18178?w=400", description: "Premium 7-seater SUV" },
            { id: 17, name: "Lamborghini Huracan", category: "cars", price: 285000, image: "https://images.unsplash.com/photo-1544636331-e26879cd4d9b?w=400", description: "Exotic supercar" },
            { id: 18, name: "Toyota Land Cruiser", category: "cars", price: 87500, image: "https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?w=400", description: "Legendary off-roader" },
            { id: 19, name: "Lexus ES", category: "cars", price: 45000, image: "https://images.unsplash.com/photo-1563720360172-67b8f3dce741?w=400", description: "Refined luxury sedan" },
            { id: 20, name: "Ferrari F8", category: "cars", price: 295000, image: "https://images.unsplash.com/photo-1592198084033-aade902d1aae?w=400", description: "Italian masterpiece" },
            { id: 21, name: "Jeep Wrangler", category: "cars", price: 38500, image: "https://images.unsplash.com/photo-1606220838315-056192d5e927?w=400", description: "Adventure-ready SUV" },
            { id: 22, name: "Cadillac Escalade", category: "cars", price: 82000, image: "https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?w=400", description: "Luxury full-size SUV" },
            { id: 23, name: "Aston Martin DB11", category: "cars", price: 215000, image: "https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=400", description: "British grand tourer" },
            { id: 24, name: "Volvo XC90", category: "cars", price: 57500, image: "https://images.unsplash.com/photo-1615906655593-ad0386982a0f?w=400", description: "Safe and stylish SUV" },
            { id: 25, name: "Maserati Ghibli", category: "cars", price: 78000, image: "https://images.unsplash.com/photo-1580274455191-1c62238fa333?w=400", description: "Italian luxury sports sedan" },

            // GADGETS - 15 items
            { id: 26, name: "iPhone 15 Pro Max", category: "gadgets", price: 1199, image: "https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=400", description: "Latest flagship smartphone" },
            { id: 27, name: "MacBook Pro M3", category: "gadgets", price: 2499, image: "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=400", description: "M3 chip, 16GB RAM, 512GB SSD" },
            { id: 28, name: "iPad Pro 12.9", category: "gadgets", price: 1099, image: "https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=400", description: "Professional tablet with M2 chip" },
            { id: 29, name: "Samsung Galaxy S24 Ultra", category: "gadgets", price: 1299, image: "https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=400", description: "Android flagship with S Pen" },
            { id: 30, name: "Apple Watch Ultra", category: "gadgets", price: 799, image: "https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=400", description: "Rugged smartwatch" },
            { id: 31, name: "AirPods Pro", category: "gadgets", price: 249, image: "https://images.unsplash.com/photo-1606841837239-c5a1a4a07af7?w=400", description: "Premium wireless earbuds" },
            { id: 32, name: "Sony PlayStation 5", category: "gadgets", price: 499, image: "https://images.unsplash.com/photo-1606813907291-d86efa9b94db?w=400", description: "Next-gen gaming console" },
            { id: 33, name: "Nintendo Switch OLED", category: "gadgets", price: 349, image: "https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?w=400", description: "Portable gaming system" },
            { id: 34, name: "DJI Mavic 3", category: "gadgets", price: 2199, image: "https://images.unsplash.com/photo-1473968512647-3e447244af8f?w=400", description: "Professional camera drone" },
            { id: 35, name: "GoPro Hero 12", category: "gadgets", price: 399, image: "https://images.unsplash.com/photo-1585509604206-84e694129c5e?w=400", description: "Action camera" },
            { id: 36, name: "Kindle Oasis", category: "gadgets", price: 279, image: "https://images.unsplash.com/photo-1592496431122-2349e0fbc666?w=400", description: "Premium e-reader" },
            { id: 37, name: "Surface Pro 9", category: "gadgets", price: 999, image: "https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=400", description: "2-in-1 laptop tablet" },
            { id: 38, name: "Google Pixel 8 Pro", category: "gadgets", price: 999, image: "https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=400", description: "AI-powered smartphone" },
            { id: 39, name: "Meta Quest 3", category: "gadgets", price: 499, image: "https://images.unsplash.com/photo-1622979135225-d2ba269cf1ac?w=400", description: "VR headset" },
            { id: 40, name: "Steam Deck", category: "gadgets", price: 649, image: "https://images.unsplash.com/photo-1612287230202-1ff1d85d1bdf?w=400", description: "Handheld gaming PC" },

            // ELECTRONICS - 15 items
            { id: 41, name: "Sony 77'' OLED TV", category: "electronics", price: 3299, image: "https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?w=400", description: "Premium 4K OLED display" },
            { id: 42, name: "Bose QuietComfort Ultra", category: "electronics", price: 429, image: "https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=400", description: "Premium noise cancelling" },
            { id: 43, name: "Samsung Soundbar", category: "electronics", price: 899, image: "https://images.unsplash.com/photo-1608043152269-423dbba4e7e1?w=400", description: "Dolby Atmos home theater" },
            { id: 44, name: "Canon EOS R5", category: "electronics", price: 3899, image: "https://images.unsplash.com/photo-1606988374039-c65ff7bed56a?w=400", description: "Professional mirrorless camera" },
            { id: 45, name: "Nikon Z9", category: "electronics", price: 5499, image: "https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=400", description: "Flagship camera body" },
            { id: 46, name: "Dyson Air Purifier", category: "electronics", price: 649, image: "https://images.unsplash.com/photo-1585771724684-38269d6639fd?w=400", description: "HEPA air filtration" },
            { id: 47, name: "Roomba j7+", category: "electronics", price: 799, image: "https://images.unsplash.com/photo-1558317374-067fb5f30001?w=400", description: "Smart robot vacuum" },
            { id: 48, name: "Instant Pot Pro", category: "electronics", price: 149, image: "https://images.unsplash.com/photo-1585515320310-259814833e62?w=400", description: "Multi-cooker appliance" },
            { id: 49, name: "Ninja Blender", category: "electronics", price: 179, image: "https://images.unsplash.com/photo-1585515320310-259814833e62?w=400", description: "Professional blender system" },
            { id: 50, name: "Nespresso Vertuo", category: "electronics", price: 199, image: "https://images.unsplash.com/photo-1517668808822-9ebb02f2a0e6?w=400", description: "Premium coffee maker" },
            { id: 51, name: "Weber Genesis Grill", category: "electronics", price: 1299, image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400", description: "Gas grill with smart features" },
            { id: 52, name: "LG Washer/Dryer", category: "electronics", price: 2499, image: "https://images.unsplash.com/photo-1626806787461-102c1bfaaea1?w=400", description: "Smart laundry combo" },
            { id: 53, name: "Ring Doorbell Pro", category: "electronics", price: 249, image: "https://images.unsplash.com/photo-1558089687-7b4c82c5c4ba?w=400", description: "Smart home security" },
            { id: 54, name: "Sonos Arc", category: "electronics", price: 899, image: "https://images.unsplash.com/photo-1545454675-3531b543be5d?w=400", description: "Premium soundbar" },
            { id: 55, name: "Philips Hue Starter", category: "electronics", price: 199, image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=400", description: "Smart lighting system" },

            // FASHION - 20 items
            { id: 56, name: "Rolex Submariner", category: "fashion", price: 12500, image: "https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=400", description: "Iconic luxury dive watch" },
            { id: 57, name: "Leather Jacket", category: "fashion", price: 799, image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=400", description: "Genuine leather biker jacket" },
            { id: 58, name: "Gucci Handbag", category: "fashion", price: 2100, image: "https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=400", description: "Designer leather bag" },
            { id: 59, name: "Ray-Ban Aviators", category: "fashion", price: 189, image: "https://images.unsplash.com/photo-1511499767150-a48a237f0083?w=400", description: "Classic sunglasses" },
            { id: 60, name: "Nike Air Jordan 1", category: "fashion", price: 179, image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400", description: "Iconic basketball sneakers" },
            { id: 61, name: "Canada Goose Parka", category: "fashion", price: 1095, image: "https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=400", description: "Winter jacket" },
            { id: 62, name: "Armani Suit", category: "fashion", price: 1899, image: "https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=400", description: "Tailored business suit" },
            { id: 63, name: "Burberry Trench Coat", category: "fashion", price: 1990, image: "https://images.unsplash.com/photo-1539533113208-f6df8cc8b543?w=400", description: "Classic designer coat" },
            { id: 64, name: "Louis Vuitton Belt", category: "fashion", price: 575, image: "https://images.unsplash.com/photo-1624222247344-550fb60583bb?w=400", description: "Luxury leather belt" },
            { id: 65, name: "Adidas Ultraboost", category: "fashion", price: 189, image: "https://images.unsplash.com/photo-1556906781-9a412961c28c?w=400", description: "Performance running shoes" },
            { id: 66, name: "Polo Ralph Lauren", category: "fashion", price: 98, image: "https://images.unsplash.com/photo-1586790170083-2f9ceadc732d?w=400", description: "Classic polo shirt" },
            { id: 67, name: "Levi's 501 Jeans", category: "fashion", price: 98, image: "https://images.unsplash.com/photo-1542272604-787c3835535d?w=400", description: "Original fit denim" },
            { id: 68, name: "Prada Sneakers", category: "fashion", price: 790, image: "https://images.unsplash.com/photo-1460353581641-37baddab0fa2?w=400", description: "Designer casual shoes" },
            { id: 69, name: "Hermès Scarf", category: "fashion", price: 425, image: "https://images.unsplash.com/photo-1601924994987-69e26d50dc26?w=400", description: "Silk luxury accessory" },
            { id: 70, name: "Cartier Bracelet", category: "fashion", price: 6500, image: "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?w=400", description: "Gold love bracelet" },
            { id: 71, name: "Versace Sunglasses", category: "fashion", price: 345, image: "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400", description: "Designer eyewear" },
            { id: 72, name: "Tommy Hilfiger Shirt", category: "fashion", price: 89, image: "https://images.unsplash.com/photo-1602810316693-3667c854239a?w=400", description: "Classic button-down" },
            { id: 73, name: "Timberland Boots", category: "fashion", price: 198, image: "https://images.unsplash.com/photo-1520639888713-7851133b1ed0?w=400", description: "Waterproof work boots" },
            { id: 74, name: "Michael Kors Watch", category: "fashion", price: 225, image: "https://images.unsplash.com/photo-1524592094714-0f0654e20314?w=400", description: "Fashion smartwatch" },
            { id: 75, name: "North Face Backpack", category: "fashion", price: 129, image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400", description: "Outdoor adventure pack" }
        ];

        let cart = [];
        let selectedCard = null;
        let currentCategory = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            displayProducts(products);
            loadUserCards();
            updateCartUI();
        });

        // Display Products
        function displayProducts(productsToShow) {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = productsToShow.map(product => `
                <div class="product-card">
                    <img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/400x300?text=${product.name}'">
                    <div class="product-info">
                        <div class="product-category">${product.category}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description}</div>
                        <div class="product-footer">
                            <div class="product-price">$${product.price.toLocaleString()}</div>
                            <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                                <i class="fas fa-cart-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter by Category
        function filterCategory(category) {
            currentCategory = category;
            const buttons = document.querySelectorAll('.category-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const filtered = category === 'all' ? products : products.filter(p => p.category === category);
            displayProducts(filtered);
        }

        // Search Products
        function searchProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.description.toLowerCase().includes(query) ||
                p.category.toLowerCase().includes(query)
            );
            displayProducts(filtered);
        }

        // Add to Cart
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ ...product, quantity: 1 });
            }

            updateCartUI();
            showNotification('Added to cart!');
        }

        // Remove from Cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartUI();
        }

        // Update Cart UI
        function updateCartUI() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;

            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart"><i class="fas fa-shopping-cart"></i><p>Your cart is empty</p></div>';
                cartTotal.textContent = '$0.00';
            } else {
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = `$${total.toLocaleString()}`;

                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}" class="cart-item-image" onerror="this.src='https://via.placeholder.com/80'">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">$${item.price.toLocaleString()} x ${item.quantity}</div>
                            <button class="remove-item" onclick="removeFromCart(${item.id})">Remove</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Toggle Cart
        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('active');
        }

        // Load User Cards
      // ✅ NEW CODE
async function loadUserCards() {
    try {
        const response = await fetch('https://valley.pvbonline.online/api/users/cards', {
            // ↑ Fixed domain: valley.pvbonline.online
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            // Handle both response formats
            const cards = data.cards || data;
            displayCards(cards);
        } else {
            console.error('Failed to load cards:', response.status);
            displayCards([]); // Show empty state
        }
    } catch (error) {
        console.error('Error loading cards:', error);
        displayCards([]); // Show empty state instead of crashing
    }
}

        // Display Cards in Checkout
        function displayCards(cards) {
            const cardsList = document.getElementById('cardsList');
            if (cards.length === 0) {
                cardsList.innerHTML = '<p style="color: #636e72;">No cards available. Please add a card first.</p>';
            } else {
                cardsList.innerHTML = cards.map(card => `
                    <div class="card-select" onclick="selectCard('${card.cardNumber}', '${card._id}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 5px;">${card.cardType.toUpperCase()}</div>
                                <div class="card-number">•••• •••• •••• ${card.cardNumber.slice(-4)}</div>
                            </div>
                            <i class="fas fa-credit-card" style="font-size: 24px; color: #667eea;"></i>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Select Card
        function selectCard(cardNumber, cardId) {
            selectedCard = { cardNumber, cardId };
            document.querySelectorAll('.card-select').forEach(card => card.classList.remove('selected'));
            event.target.closest('.card-select').classList.add('selected');
        }

        // Open Checkout
        function openCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            document.getElementById('checkoutModal').classList.add('active');
        }

        // Close Checkout
        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
        }

        // Handle Checkout
      document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    if (!selectedCard) {
        alert('Please select a card');
        return;
    }

    const pin = document.getElementById('pin').value;
    const address = document.getElementById('address').value;

    // Validate PIN length
    if (pin.length !== 4) {
        alert('Please enter a 4-digit PIN');
        return;
    }

    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    const payBtn = document.getElementById('payBtn');
    const originalText = payBtn.innerHTML;
    payBtn.innerHTML = '<span class="loading"></span> Processing...';
    payBtn.disabled = true;

    try {
        const response = await fetch('https://valley.pvbonline.online/api/user/card-purchase', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({
                cardId: selectedCard.cardId,
                pin: pin,
                amount: total,
                items: cart,
                deliveryAddress: address
            })
        });

        const result = await response.json();

        if (response.ok) {
            alert('✅ Payment successful! Your order has been placed.');
            cart = [];
            updateCartUI();
            closeCheckout();
            document.getElementById('checkoutForm').reset();
        } else {
            // Handle specific error cases
            if (result.message && result.message.includes('Card not found')) {
                alert('❌ No card found!\n\nPlease create a card first.');
                window.location.href = 'useratmcard';
            } else if (result.message && result.message.includes('Incorrect PIN')) {
                alert('❌ Incorrect PIN!\n\nPlease try again.');
            } else if (result.message && result.message.includes('Insufficient card balance')) {
                alert('❌ Insufficient card balance!\n\nPlease fund your card first.');
                window.location.href = 'fund-card.html';
            } else {
                alert(`❌ Payment failed: ${result.message}`);
            }
        }
    } catch (error) {
        alert('❌ Network error. Please try again.');
        console.error('Error:', error);
    } finally {
        payBtn.innerHTML = originalText;
        payBtn.disabled = false;
    }
});

     // Open Forgot Card PIN Modal
document.getElementById('forgotCardPinLink').addEventListener('click', function(e) {
    e.preventDefault();
    closeCheckout(); // close checkout modal if open
    const cardSelect = document.getElementById('cardSelectForReset');

    // Populate with user's cards
    const cards = document.querySelectorAll('.card-select');
    cardSelect.innerHTML = Array.from(cards).map(card => {
        const cardNumber = card.textContent.match(/\d{4}$/)[0]; // last 4 digits
        return `<option value="${cardNumber}">•••• •••• •••• ${cardNumber}</option>`;
    }).join('');

    document.getElementById('forgotCardPinModal').classList.add('active');
});

// Handle Forgot Card PIN Form Submission
document.getElementById('forgotCardPinForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const selectedCard = document.getElementById('cardSelectForReset').value;

    try {
        const res = await fetch('https://valley.pvbonline.online/api/users/card-reset-pin', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify({ cardNumber: selectedCard })
        });

        const data = await res.json();

        if (res.ok) {
            alert('✅ PIN reset instructions sent to your email!');
            closeModal('forgotCardPinModal');
        } else {
            alert('❌ ' + (data.message || 'Failed to send PIN reset instructions.'));
        }
    } catch (err) {
        console.error(err);
        alert('❌ Network error. Please try again.');
    }
});



        // Show Notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: #10ac84;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 2000);
        }





        // --- RESET CARD PIN HANDLER ---
// This runs when user clicks the email link (with ?token= & card=)
document.addEventListener("DOMContentLoaded", async () => {
  const params = new URLSearchParams(window.location.search);
  const resetToken = params.get("token");
  const cardNumber = params.get("card");

  if (resetToken && cardNumber) {
    // Auto-open the reset modal
    const resetModal = document.getElementById("resetCardPinModal");
    resetModal.classList.add("active");

    // Pre-fill the card dropdown
    const resetCardSelect = document.getElementById("resetCardSelect");
    resetCardSelect.innerHTML = `<option value="${cardNumber}" selected>•••• •••• •••• ${cardNumber.slice(-4)}</option>`;

    // Handle form submission
    const resetForm = document.getElementById("resetCardPinForm");
    resetForm.addEventListener("submit", async function (e) {
      e.preventDefault();

      const newPin = document.getElementById("newTransactionPin").value;

      if (!/^\d{4}$/.test(newPin)) {
        alert("❌ Please enter a valid 4-digit PIN.");
        return;
      }

      try {
        const res = await fetch("https://valley.pvbonline.online/api/users/reset-card-pin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            token: resetToken,
            newPin,
            cardNumber,
          }),
        });

        const data = await res.json();

        if (res.ok) {
          alert("✅ Your card PIN has been reset successfully!");
          closeModal("resetCardPinModal");
          window.history.replaceState({}, document.title, window.location.pathname);
        } else {
          alert("❌ " + (data.message || "Failed to reset PIN. Please try again."));
        }
      } catch (err) {
        console.error(err);
        alert("❌ Network error. Please try again.");
      }
    });
  }
});

    </script>
</body>
</html>